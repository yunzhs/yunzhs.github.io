### 动态生成账单excel

**如何将模板与整合数据关联，动态生成（难点）？**

 现有模板为：

![image-20220211173647743](/Users/gengyiwei/Library/Application Support/typora-user-images/image-20220211173647743.png)

现在生成账单明细excel方式为：表头均为模板事先定义好，再把数据进行填充。

修改为动态模板后：**主要变化是表头要动态生成，从而根据表头填充数据**。



思路一：根据上传的模板读取，生成规则

![image-20220211151043319](/Users/gengyiwei/笔记/博客/yunzhs.github.io/img/posts/image-20220211151043319.png)

新建模板管理系统，配置各种类型的模板，再给商户配置不同类别的模板，再根据模板配置自动读取整合实体类中对应的数据。

模板系统系统记录名称和编码的映射，在用户上传模板后，读取前几行的列数据，记录该模板的表头数据--》对应的行列坐标。

![image-20220215113601744](/Users/gengyiwei/Library/Application Support/typora-user-images/image-20220215113601744.png)

这里可以看到应该只勾选险种即可，每种险种下面的基数比例字段是固定的（支持配置）。

缺点：对应上传的模板要求很高，校验改正的难度比较大。



思路二：读取商户保险配置，根据险种生成相应的excel

有几种险种就生成几种险种的模板

模板分为常驻字段和险种字段，常驻字段一直在，险种字段根据配置进行拼装。



4、根据商户号、类别，读取模板规则

根据规则，生成对应的excel表头，并从对应的汇总数据中取需要的数据，excel生成完毕。

##### 其他优化：

（1）、账单首页的生成修改为填充模式，大大提高模板和代码的可用性和易读性。

![image-20220214105037775](/Users/gengyiwei/Library/Application Support/typora-user-images/image-20220214105037775.png)

（2）、模板系统支持固定表头和单元格颜色功能。

（3）、各类账单间有大量同类数据，如社保账单，外包账单，在缴明细都可能存在**养老个人基数**、**养老单位基数**字段。但是目前情况为每种账单都会建一个实体类，存在大量重复，因此新建一个包含所有数据实体类，预估字段量为120。

##### 涉及到的excel账单：

社保账单（包含长护险的新模板）

商保账单

外包账单

在缴明细账单（包含长护险的新模板）

集团社保账单（包含长护险的新模板）

集团商保账单